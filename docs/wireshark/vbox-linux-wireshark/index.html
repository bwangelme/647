<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.117.0">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/647/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/647/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/647/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/647/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/647/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/647/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/647/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/647/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/647/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/647/favicons/android-192x192.png" sizes="192x192">

<title>利用 VirtualBox 和 Ubuntu 22 重现抓包实验 | 647 Universe</title>
<meta name="description" content="实验介绍 在 《Wireshark网络分析就这么简单》 第一章，讲述了一道面试题。
HostA 和 HostB 在同一个局域网中，它们的 IP 配置如下，请问这两台机器能否 ping 通?
HostA: IP: 192.168.26.129/24 Gateway: 192.168.26.2 HostB: IP: 192.168.26.3/27 Gateway: 192.168.26.2 答案是能够 ping 通，HostA 和 HostB 连同网关最终会形成一个奇怪的网络
具体通信过程如下:
HostA(192.168.26.129) 发送 ping 请求给 HostB(192.168.26.3) HostA 将 HostB 的 IP 和自己的掩码计算，发现 192.168.26.3 和自己是处于同一子网 HostA 通过 ARP 协议广播寻找 192.168.26.3 的 MAC 地址，由于 192.168.26.3 和它在同一局域网中，192.168.26.3 会应答自己的 MAC 地址 HostA 将 ping 请求直接发送给 192.168.26.3, 目的 MAC 地址使用的就是 192.168.26.3 的地址 HostB(192.168.26.3) 收到 ping 请求，给 HostA 发送 ping 响应 HostB 将 HostA 的 IP 和自己的掩码计算，发现 192.">
<meta property="og:title" content="利用 VirtualBox 和 Ubuntu 22 重现抓包实验" />
<meta property="og:description" content="实验介绍 在 《Wireshark网络分析就这么简单》 第一章，讲述了一道面试题。
HostA 和 HostB 在同一个局域网中，它们的 IP 配置如下，请问这两台机器能否 ping 通?
HostA: IP: 192.168.26.129/24 Gateway: 192.168.26.2 HostB: IP: 192.168.26.3/27 Gateway: 192.168.26.2 答案是能够 ping 通，HostA 和 HostB 连同网关最终会形成一个奇怪的网络
具体通信过程如下:
HostA(192.168.26.129) 发送 ping 请求给 HostB(192.168.26.3) HostA 将 HostB 的 IP 和自己的掩码计算，发现 192.168.26.3 和自己是处于同一子网 HostA 通过 ARP 协议广播寻找 192.168.26.3 的 MAC 地址，由于 192.168.26.3 和它在同一局域网中，192.168.26.3 会应答自己的 MAC 地址 HostA 将 ping 请求直接发送给 192.168.26.3, 目的 MAC 地址使用的就是 192.168.26.3 的地址 HostB(192.168.26.3) 收到 ping 请求，给 HostA 发送 ping 响应 HostB 将 HostA 的 IP 和自己的掩码计算，发现 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bwangelme.github.io/647/docs/wireshark/vbox-linux-wireshark/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-08-23T10:07:25+08:00" />
<meta property="article:modified_time" content="2023-08-24T00:03:23+08:00" /><meta property="og:site_name" content="647号宇宙" />
<meta itemprop="name" content="利用 VirtualBox 和 Ubuntu 22 重现抓包实验">
<meta itemprop="description" content="实验介绍 在 《Wireshark网络分析就这么简单》 第一章，讲述了一道面试题。
HostA 和 HostB 在同一个局域网中，它们的 IP 配置如下，请问这两台机器能否 ping 通?
HostA: IP: 192.168.26.129/24 Gateway: 192.168.26.2 HostB: IP: 192.168.26.3/27 Gateway: 192.168.26.2 答案是能够 ping 通，HostA 和 HostB 连同网关最终会形成一个奇怪的网络
具体通信过程如下:
HostA(192.168.26.129) 发送 ping 请求给 HostB(192.168.26.3) HostA 将 HostB 的 IP 和自己的掩码计算，发现 192.168.26.3 和自己是处于同一子网 HostA 通过 ARP 协议广播寻找 192.168.26.3 的 MAC 地址，由于 192.168.26.3 和它在同一局域网中，192.168.26.3 会应答自己的 MAC 地址 HostA 将 ping 请求直接发送给 192.168.26.3, 目的 MAC 地址使用的就是 192.168.26.3 的地址 HostB(192.168.26.3) 收到 ping 请求，给 HostA 发送 ping 响应 HostB 将 HostA 的 IP 和自己的掩码计算，发现 192."><meta itemprop="datePublished" content="2023-08-23T10:07:25+08:00" />
<meta itemprop="dateModified" content="2023-08-24T00:03:23+08:00" />
<meta itemprop="wordCount" content="1301">
<meta itemprop="keywords" content="wireshark,blog," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="利用 VirtualBox 和 Ubuntu 22 重现抓包实验"/>
<meta name="twitter:description" content="实验介绍 在 《Wireshark网络分析就这么简单》 第一章，讲述了一道面试题。
HostA 和 HostB 在同一个局域网中，它们的 IP 配置如下，请问这两台机器能否 ping 通?
HostA: IP: 192.168.26.129/24 Gateway: 192.168.26.2 HostB: IP: 192.168.26.3/27 Gateway: 192.168.26.2 答案是能够 ping 通，HostA 和 HostB 连同网关最终会形成一个奇怪的网络
具体通信过程如下:
HostA(192.168.26.129) 发送 ping 请求给 HostB(192.168.26.3) HostA 将 HostB 的 IP 和自己的掩码计算，发现 192.168.26.3 和自己是处于同一子网 HostA 通过 ARP 协议广播寻找 192.168.26.3 的 MAC 地址，由于 192.168.26.3 和它在同一局域网中，192.168.26.3 会应答自己的 MAC 地址 HostA 将 ping 请求直接发送给 192.168.26.3, 目的 MAC 地址使用的就是 192.168.26.3 的地址 HostB(192.168.26.3) 收到 ping 请求，给 HostA 发送 ping 响应 HostB 将 HostA 的 IP 和自己的掩码计算，发现 192."/>




<link rel="preload" href="/647/scss/main.min.291c723daa8f2fb6b09f56ac9a2ca71406607a4268e1fe586dddad1a8583b4e7.css" as="style">
<link href="/647/scss/main.min.291c723daa8f2fb6b09f56ac9a2ca71406607a4268e1fe586dddad1a8583b4e7.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/647/css/prism.css"/>

  </head>
  <body class="td-page">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/647/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">647 Universe</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/647/docs/"><span>Docs</span></a>
      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-647docs-li">
  <a href="/647/docs/" title="Documentation" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-647docs"><span class="">Docs</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-647docswireshark-li">
  <a href="/647/docs/wireshark/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docswireshark"><span class="">WireShark</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-647docswiresharkvbox-linux-wireshark-li">
  <a href="/647/docs/wireshark/vbox-linux-wireshark/" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id="m-647docswiresharkvbox-linux-wireshark"><span class="td-sidebar-nav-active-item">利用 VirtualBox 和 Ubuntu 22 重现抓包实验</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-647docsgolang-li">
  <a href="/647/docs/golang/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docsgolang"><span class="">Golang</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsgolanggeneric-li">
  <a href="/647/docs/golang/generic/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsgolanggeneric"><span class="">泛型</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsgolangyaml-li">
  <a href="/647/docs/golang/yaml/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsgolangyaml"><span class="">YAML</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsgolanggo-release-li">
  <a href="/647/docs/golang/go-release/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsgolanggo-release"><span class="">Golang 的版本发布计划</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsgolanggoproxy-li">
  <a href="/647/docs/golang/goproxy/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsgolanggoproxy"><span class="">Go proxy 的说明</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-647docsperformance-li">
  <a href="/647/docs/performance/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docsperformance"><span class="">性能分析</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsperformanceqps_rt-li">
  <a href="/647/docs/performance/qps_rt/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsperformanceqps_rt"><span class="">QPS 和 RT 的关系</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-647docsthrift-li">
  <a href="/647/docs/thrift/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docsthrift"><span class="">Thrift</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsthriftgolang-client-timeout-li">
  <a href="/647/docs/thrift/golang-client-timeout/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsthriftgolang-client-timeout"><span class="">Thrift golang client 如何设置超时时间</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsthriftthrft-concept-li">
  <a href="/647/docs/thrift/thrft-concept/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsthriftthrft-concept"><span class="">Thrft</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-647docsspec-li">
  <a href="/647/docs/spec/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docsspec"><span class="">规范</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docsspecdatetime-li">
  <a href="/647/docs/spec/datetime/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docsspecdatetime"><span class="">日期和时间格式</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-647docseditor-li">
  <a href="/647/docs/editor/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docseditor"><span class="">编辑器</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docseditorpycharm-li">
  <a href="/647/docs/editor/pycharm/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docseditorpycharm"><span class="">Pycharm</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-647docslinux-li">
  <a href="/647/docs/linux/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-647docslinux"><span class="">Linux</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docslinuxcurl-li">
  <a href="/647/docs/linux/curl/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docslinuxcurl"><span class="">curl</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-647docslinuxlsof-li">
  <a href="/647/docs/linux/lsof/" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id="m-647docslinuxlsof"><span class="">lsof</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/bwangelme/647/tree/master/content/cn/docs/wireshark/vbox-linux-wireshark.md" class="td-page-meta--view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> </a>
  <a href="https://github.com/bwangelme/647/edit/master/content/cn/docs/wireshark/vbox-linux-wireshark.md" class="td-page-meta--edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> </a>
  <a href="https://github.com/bwangelme/647/new/master/content/cn/docs/wireshark/vbox-linux-wireshark.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> </a>
  <a href="https://github.com/bwangelme/647/issues/new?title=%e5%88%a9%e7%94%a8%20VirtualBox%20%e5%92%8c%20Ubuntu%2022%20%e9%87%8d%e7%8e%b0%e6%8a%93%e5%8c%85%e5%ae%9e%e9%aa%8c" class="td-page-meta--issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> </a>
  <a href="https://github.com/bwangelme/647/issues/new" class="td-page-meta--project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> </a>
  <a id="print" href="https://bwangelme.github.io/647/docs/wireshark/_print/"><i class="fa-solid fa-print fa-fw"></i> </a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#实验介绍">实验介绍</a></li>
    <li><a href="#开始实验">开始实验</a>
      <ul>
        <li><a href="#配置-vagrant">配置 Vagrant</a></li>
        <li><a href="#启动并配置-vbox">启动并配置 VBox</a></li>
        <li><a href="#设置-vbox-网络">设置 VBox 网络</a></li>
        <li><a href="#手动设置机器的-ip">手动设置机器的 IP</a></li>
      </ul>
    </li>
    <li><a href="#问题1-192168263-地址存在两个">问题1: 192.168.26.3 地址存在两个</a></li>
    <li><a href="#问题2-网关没有转发">问题2: 网关没有转发</a></li>
    <li><a href="#参考链接">参考链接</a></li>
  </ul>
</nav>
      </div>
    
            <div class="taxonomy taxonomy-terms-cloud taxo-tags">
      <h5 class="taxonomy-title">Tag Cloud</h5>
      <ul class="taxonomy-terms">
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/blog/" data-taxonomy-term="blog"><span class="taxonomy-label">blog</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/datetime/" data-taxonomy-term="datetime"><span class="taxonomy-label">datetime</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/go/" data-taxonomy-term="go"><span class="taxonomy-label">go</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/golang/" data-taxonomy-term="golang"><span class="taxonomy-label">Golang</span><span class="taxonomy-count">2</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/gomod/" data-taxonomy-term="gomod"><span class="taxonomy-label">gomod</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/linux/" data-taxonomy-term="linux"><span class="taxonomy-label">linux</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/lsof/" data-taxonomy-term="lsof"><span class="taxonomy-label">lsof</span><span class="taxonomy-count">1</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/thrift/" data-taxonomy-term="thrift"><span class="taxonomy-label">thrift</span><span class="taxonomy-count">3</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/tips/" data-taxonomy-term="tips"><span class="taxonomy-label">tips</span><span class="taxonomy-count">5</span></a></li>
        <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/wireshark/" data-taxonomy-term="wireshark"><span class="taxonomy-label">wireshark</span><span class="taxonomy-count">1</span></a></li>
        </ul>
    </div>
  
	
          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://bwangelme.github.io/647/docs/">Docs</a></li>
  <li class="breadcrumb-item">
    <a href="https://bwangelme.github.io/647/docs/wireshark/">WireShark</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    利用 VirtualBox 和 Ubuntu 22 重现抓包实验</li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>利用 VirtualBox 和 Ubuntu 22 重现抓包实验</h1>
	
	<header class="article-meta">
		<div class="taxonomy taxonomy-terms-article taxo-tags">
  <h5 class="taxonomy-title">Tags:</h5>
  <ul class="taxonomy-terms">
    <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/wireshark/" data-taxonomy-term="wireshark"><span class="taxonomy-label">wireshark</span></a></li>
    <li><a class="taxonomy-term" href="https://bwangelme.github.io/647/tags/blog/" data-taxonomy-term="blog"><span class="taxonomy-label">blog</span></a></li>
    </ul>
</div>

  </header>
	<h2 id="实验介绍">实验介绍</h2>
<p>在 <a href="https://book.douban.com/subject/26268767/">《Wireshark网络分析就这么简单》</a> 第一章，讲述了一道面试题。</p>
<p>HostA 和 HostB 在同一个局域网中，它们的 IP 配置如下，请问这两台机器能否 ping 通?</p>
<pre tabindex="0"><code>HostA: 
    IP: 192.168.26.129/24
    Gateway: 192.168.26.2
HostB: 
    IP: 192.168.26.3/27
    Gateway: 192.168.26.2
</code></pre><p>答案是能够 ping 通，HostA 和 HostB 连同网关最终会形成一个奇怪的网络</p>
<p><img src="https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-08-23-103426.png" alt=""></p>
<p>具体通信过程如下:</p>
<ul>
<li>HostA(<code>192.168.26.129</code>) 发送 ping 请求给 HostB(<code>192.168.26.3</code>)
<ul>
<li>HostA 将 HostB 的 IP 和自己的掩码计算，发现 <code>192.168.26.3</code> 和自己是处于同一子网</li>
<li>HostA 通过 ARP 协议广播寻找 <code>192.168.26.3</code> 的 MAC 地址，由于 <code>192.168.26.3</code> 和它在同一局域网中，<code>192.168.26.3</code> 会应答自己的 MAC 地址</li>
<li>HostA 将 ping 请求直接发送给 <code>192.168.26.3</code>, 目的 MAC 地址使用的就是 <code>192.168.26.3</code> 的地址</li>
</ul>
</li>
<li>HostB(<code>192.168.26.3</code>) 收到 ping 请求，给 HostA 发送 ping 响应
<ul>
<li>HostB 将 HostA 的 IP 和自己的掩码计算，发现 <code>192.168.26.129</code> 和自己不是同一子网
<ul>
<li>192.168.26.3 &amp; 255.255.255.224 == 192.168.26.0</li>
<li>192.168.26.129 &amp; 255.255.255.224 == 192.168.26.128</li>
</ul>
</li>
<li>HostB 将 ping 响应发送给网关，由网关进行路由发送
<ul>
<li>HostB 通过 APR 协议广播寻找网关 <code>192.168.26.2</code> 的 MAC 地址，网关 <code>192.168.26.2</code> 告诉 HostB 自己的 MAC</li>
<li>HostB 发送 ping 响应包，目的 IP 是 <code>192.168.26.129</code>, 目的 MAC 是网关的 MAC 地址</li>
</ul>
</li>
<li>网关将 ping 响应发送给了 HostA</li>
</ul>
</li>
</ul>
<h2 id="开始实验">开始实验</h2>
<p>读完以后，感觉这个测试挺好玩，就尝试在本地复现了一下。</p>
<p>我的环境如下，3台安装了 Ubuntu 22.04 Vitualbox 虚拟机, 它们分别充当 HostA, HostB 和 网关</p>
<p><img src="https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-08-23-224057.png" alt=""></p>
<h3 id="配置-vagrant">配置 Vagrant</h3>
<p>我的 VirtualBox 是通过 Vagrant 启动的</p>
<ul>
<li>首先我们需要在 Vagrant 官网上下载 Ubuntu 22.04 的 Box</li>
</ul>
<p><a href="https://app.vagrantup.com/ubuntu/boxes/jammy64">ubuntu/jammy64 Vagrant box 下载地址</a></p>
<p>下载完成之后通过如下命令添加 Vagrant Box</p>
<pre tabindex="0"><code>vagrant box add ~/Downloads/jammy-server-cloudimg-amd64-vagrant.box --name ubuntu/jammy
</code></pre><p>添加完成后使用 <code>vagrant box list</code> 可以看到我们添加的 box 名字了</p>
<ul>
<li>接着我们再来安装 <code>vagrant-disksize</code> 插件</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 建议在执行命令前挂上 http 代理</span>
</span></span><span style="display:flex;"><span>vagrant plugin install vagrant-disksize
</span></span></code></pre></div><h3 id="启动并配置-vbox">启动并配置 VBox</h3>
<p>这是我的 Vagrantfile, 它启动了三个 virtualbox 虚拟机，分别命名为 vbox1, vbox2, vbox3。完整代码见 <a href="https://github.com/bwangelme/DockerVbox.git">github/bwangelme/DockerVbox.git</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -*- mode: ruby -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># vi: set ft=ruby :</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Verify whether required plugins are installed.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">required_plugins</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">[</span> <span style="color:#4e9a06">&#34;vagrant-disksize&#34;</span> <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">required_plugins</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">each</span> <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">plugin</span><span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">Vagrant</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">has_plugin?</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plugin</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#4e9a06">&#34;The vagrant plugin </span><span style="color:#4e9a06">#{</span><span style="color:#000">plugin</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> is required. Please run `vagrant plugin install </span><span style="color:#4e9a06">#{</span><span style="color:#000">plugin</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">`&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">Vagrant</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">configure</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">config</span><span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">config</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">box_check_update</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">$num_instances</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">..</span><span style="color:#000">$num_instances</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">each</span> <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">config</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">define</span> <span style="color:#4e9a06">&#34;vbox</span><span style="color:#4e9a06">#{</span><span style="color:#000">i</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">box</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;ubuntu/jammy&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">hostname</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;vbox</span><span style="color:#4e9a06">#{</span><span style="color:#000">i</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">provider</span> <span style="color:#4e9a06">&#34;virtualbox&#34;</span> <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">vb</span><span style="color:#ce5c00;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">vb</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">memory</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;1024&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">vb</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cpus</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">vb</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;vbox</span><span style="color:#4e9a06">#{</span><span style="color:#000">i</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>      <span style="color:#8f5902;font-style:italic"># 单独执行 vagrant provision 也会执行一遍 install.sh 脚本</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">node</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">provision</span> <span style="color:#4e9a06">&#34;shell&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">path</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;install.sh&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><p>将 <a href="https://github.com/bwangelme/DockerVbox.git">github/bwangelme/DockerVbox.git</a> 克隆到本地，进入目录中执行</p>
<pre tabindex="0"><code>vagrant up
</code></pre><p>就可以创建并启动三个 Ubuntu 22.04 的 VirtualBox 虚机了</p>
<p>启动完成后，我们执行</p>
<pre tabindex="0"><code>vagrant halt
</code></pre><p>将虚拟机先停止，接着我们来手动设置网络。</p>
<h3 id="设置-vbox-网络">设置 VBox 网络</h3>
<ul>
<li>第一步，打开 VirtualBox 的 <strong>管理 -&gt; 全局设定</strong> ，打开网络 Tab, 添加一个 Nat 网络，设置名字为 <code>NatNetwork</code>，设置网段为 <code>192.168.26.0/24</code></li>
</ul>
<p><img src="https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-08-23-225440.png" alt=""></p>
<p><img src="https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-08-23-225556.png" alt=""></p>
<ul>
<li>第二步，分别在每个虚拟机上执行，在 <strong>虚拟机设置 -&gt; 网络</strong> 中添加网卡，<strong>连接方式</strong> 选 <code>Nat网络</code>, <strong>界面名称</strong> 选择我们刚刚创建的 <code>NatNetwork</code></li>
</ul>
<p><img src="https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-08-23-225755.png" alt=""></p>
<ul>
<li>第三步，手动启动三个虚拟机。</li>
</ul>
<p><strong>注意:</strong> 不能使用 <code>vagrant up</code> 启动, 否则我们创建的网卡就被关闭了</p>
<h3 id="手动设置机器的-ip">手动设置机器的 IP</h3>
<p>虚拟机启动后，使用如下命令可以登陆到对应的虚机上</p>
<pre tabindex="0"><code>vagrant ssh vbox1
</code></pre><p>接着我们修改 <code>/etc/netplan/50-cloud-init.yaml</code> 文件，加入我们 Nat 网卡 <code>enp0s8</code> 的配置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span> vagrant@vbox1:~$ cat /etc/netplan/50-cloud-init.yaml
</span></span><span style="display:flex;"><span> # This file is generated from information provided by the datasource.  Changes
</span></span><span style="display:flex;"><span> # to it will not persist across an instance reboot.  To disable cloud-init&#39;s
</span></span><span style="display:flex;"><span> # network configuration capabilities, write a file
</span></span><span style="display:flex;"><span> # /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
</span></span><span style="display:flex;"><span> # network: {config: disabled}
</span></span><span style="display:flex;"><span> network:
</span></span><span style="display:flex;"><span>     ethernets:
</span></span><span style="display:flex;"><span>         enp0s3:
</span></span><span style="display:flex;"><span>             dhcp4: true
</span></span><span style="display:flex;"><span>             match:
</span></span><span style="display:flex;"><span>                 macaddress: 02:20:c0:fe:1f:a9
</span></span><span style="display:flex;"><span>             set-name: enp0s3
</span></span><span style="display:flex;"><span><span style="color:#00a000">+        enp0s8:
</span></span></span><span style="display:flex;"><span><span style="color:#00a000">+            dhcp4: no
</span></span></span><span style="display:flex;"><span><span style="color:#00a000">+            addresses:
</span></span></span><span style="display:flex;"><span><span style="color:#00a000">+                - 192.168.26.129/24
</span></span></span><span style="display:flex;"><span><span style="color:#00a000">+            gateway4: 192.168.26.2
</span></span></span><span style="display:flex;"><span><span style="color:#00a000">+            nameservers:
</span></span></span><span style="display:flex;"><span><span style="color:#00a000">+                addresses: [223.5.5.5]
</span></span></span><span style="display:flex;"><span><span style="color:#00a000"></span>     version: 2
</span></span></code></pre></div><p>三台主机的配置如下</p>
<table>
<thead>
<tr>
<th>Hostname</th>
<th>网卡名称</th>
<th>IP/掩码</th>
<th>MAC 地址</th>
<th>网关</th>
</tr>
</thead>
<tbody>
<tr>
<td>vbox1</td>
<td>enp0s8</td>
<td>192.168.26.129/24</td>
<td>08:00:27:4c:f0:52</td>
<td>192.168.26.2</td>
</tr>
<tr>
<td>vbox2</td>
<td>enp0s8</td>
<td>192.168.26.3/27</td>
<td>08:00:27:69:22:ae</td>
<td>192.168.26.2</td>
</tr>
<tr>
<td>vbox3</td>
<td>enp0s8</td>
<td>192.168.26.2/24</td>
<td>08:00:27:d5:b5:13</td>
<td>192.168.26.1</td>
</tr>
</tbody>
</table>
<p>修改完配置文件后，使用以下命令将配置生效</p>
<pre tabindex="0"><code>sudo netplan apply
</code></pre><p>至此，所有的网络环境都配置成功了，我们可以开始抓包了。</p>
<h2 id="问题1-192168263-地址存在两个">问题1: 192.168.26.3 地址存在两个</h2>
<p>我在 vbox1 上执行以下抓包命令</p>
<pre tabindex="0"><code>sudo tcpdump -i enp0s8 --print -en -w vbox1_ping src host 192.168.26.3 or dst host 192.168.26.3
</code></pre><p>在另一个终端中执行 ping 发送 ICMP 包</p>
<pre tabindex="0"><code>ping -c 3 192.168.26.3
</code></pre><p>此时，很奇怪的问题出现了</p>
<p><code>192.168.26.3</code> 能够 ping 通，但请求不是从 vbox2 发回来的，而是从一个 MAC 地址为 <code>08:00:27:ae:84:b6</code> 的网卡发回来的。</p>
<pre tabindex="0"><code>01:26:47.254731 08:00:27:4c:f0:52 &gt; 08:00:27:ae:84:b6, ethertype IPv4 (0x0800), length 98: 192.168.26.129 &gt; 192.168.26.3: ICMP echo request, id 9, seq 1, length 64
01:26:47.254885 08:00:27:ae:84:b6 &gt; 08:00:27:4c:f0:52, ethertype IPv4 (0x0800), length 98: 192.168.26.3 &gt; 192.168.26.129: ICMP echo reply, id 9, seq 1, length 64
01:26:48.275239 08:00:27:4c:f0:52 &gt; 08:00:27:ae:84:b6, ethertype IPv4 (0x0800), length 98: 192.168.26.129 &gt; 192.168.26.3: ICMP echo request, id 9, seq 2, length 64
01:26:48.275415 08:00:27:ae:84:b6 &gt; 08:00:27:4c:f0:52, ethertype IPv4 (0x0800), length 98: 192.168.26.3 &gt; 192.168.26.129: ICMP echo reply, id 9, seq 2, length 64
01:26:49.298910 08:00:27:4c:f0:52 &gt; 08:00:27:ae:84:b6, ethertype IPv4 (0x0800), length 98: 192.168.26.129 &gt; 192.168.26.3: ICMP echo request, id 9, seq 3, length 64
01:26:49.299089 08:00:27:ae:84:b6 &gt; 08:00:27:4c:f0:52, ethertype IPv4 (0x0800), length 98: 192.168.26.3 &gt; 192.168.26.129: ICMP echo reply, id 9, seq 3, length 64
01:26:52.370038 08:00:27:4c:f0:52 &gt; 08:00:27:ae:84:b6, ethertype ARP (0x0806), length 42: Request who-has 192.168.26.3 tell 192.168.26.129, length 28
01:26:52.370156 08:00:27:ae:84:b6 &gt; 08:00:27:4c:f0:52, ethertype ARP (0x0806), length 60: Reply 192.168.26.3 is-at 08:00:27:ae:84:b6, length 46

# 这个抓包更奇怪，vbox1 询问 192.168.26.3 的 MAC 地址，有两个地址发来了响应
vagrant@vbox1:~$ sudo tcpdump -i enp0s8 --print src host 192.168.26.3 or dst host 192.168.26.3 -w vbox1_ping
tcpdump: listening on enp0s8, link-type EN10MB (Ethernet), snapshot length 262144 bytes
16:50:54.672007 ARP, Request who-has 192.168.26.3 tell vbox1, length 28
16:50:54.672243 ARP, Reply 192.168.26.3 is-at 08:00:27:ae:84:b6 (oui Unknown), length 46
16:50:54.672243 ARP, Reply 192.168.26.3 is-at 08:00:27:69:22:ae (oui Unknown), length 46
</code></pre><p>这个困扰了我好久，我反复检查三台 vbox 的所有网卡和我宿主机所有网卡的 MAC 地址，没有一个是符合 <code>08:00:27:ae:84:b6</code> 的。</p>
<p>后来我突发奇想，这是不是 virtualbox Nat Network 默认创建的地址，于是我将 vbox2 和 vbox3 的地址全部换掉，发现</p>
<ul>
<li>192.168.26.1</li>
<li>192.168.26.2</li>
<li>192.168.26.3</li>
</ul>
<p>这三个地址依然是能够 ping 通的。</p>
<p>我用关键字 <code>vbox nat network gateway</code> 在 Google 中搜索，找到了 vbox 的一篇文档: <a href="https://www.virtualbox.org/manual/ch06.html#network_nat_service">6.4. Network Address Translation Service</a></p>
<p>文档中创建了一个 <code>192.168.15.0/24</code> 的 Nat 网络， 并说静态设置的网关默认被赋予地址 <code>192.168.15.1</code></p>
<blockquote>
<p>Here, natnet1 is the name of the internal network to be used and 192.168.15.0/24 is the network address and mask of the NAT service interface. By default in this static configuration the gateway will be assigned the address 192.168.15.1, the address following the interface address, though this is subject to change. To attach a DHCP server to the internal network, modify the example command as follows:</p>
</blockquote>
<p>这下我就明白了，<code>192.168.26.1</code>, <code>192.168.26.2</code>, <code>192.168.26.3</code> 是 Vbox Nat 网络的保留地址，<code>192.168.26.1</code> 是默认网关，<code>192.168.26.3</code> 是 DNS Server 的地址(因为它的 53 端口能用 UDP 连上), <code>192.168.26.2</code> 是干嘛的还没搞明白</p>
<p>为了不冲突，我们改一下我们三台机器的地址，新地址如下</p>
<table>
<thead>
<tr>
<th>Hostname</th>
<th>网卡名称</th>
<th>IP/掩码</th>
<th>MAC 地址</th>
<th>网关</th>
</tr>
</thead>
<tbody>
<tr>
<td>vbox1</td>
<td>enp0s8</td>
<td>192.168.26.129/24</td>
<td>08:00:27:4c:f0:52</td>
<td>192.168.26.123</td>
</tr>
<tr>
<td>vbox2</td>
<td>enp0s8</td>
<td>192.168.26.122/27</td>
<td>08:00:27:69:22:ae</td>
<td>192.168.26.123</td>
</tr>
<tr>
<td>vbox3</td>
<td>enp0s8</td>
<td>192.168.26.123/24</td>
<td>08:00:27:d5:b5:13</td>
<td>192.168.26.1</td>
</tr>
</tbody>
</table>
<h2 id="问题2-网关没有转发">问题2: 网关没有转发</h2>
<p>更新了 IP 地址后，我们接着在 vbox1 上 ping <code>192.168.26.122</code>, 此时出现的问题是 ping 不通了，看起来上一个问题解决了，但是新的问题出现了。</p>
<p>我在 vbox2 上抓了一下包，看到了如下内容</p>
<pre tabindex="0"><code>vagrant@vbox2:~$ sudo tcpdump -i enp0s8 --print -en
17:17:56.850218 08:00:27:4c:f0:52 &gt; 08:00:27:69:22:ae, ethertype IPv4 (0x0800), length 98: 192.168.26.129 &gt; 192.168.26.122: ICMP echo request, id 25, seq 8, length 64
17:17:56.850246 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 25, seq 8, length 64
17:17:57.868013 08:00:27:4c:f0:52 &gt; 08:00:27:69:22:ae, ethertype IPv4 (0x0800), length 98: 192.168.26.129 &gt; 192.168.26.122: ICMP echo request, id 25, seq 9, length 64
17:17:57.868046 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 25, seq 9, length 64
17:17:58.883354 08:00:27:4c:f0:52 &gt; 08:00:27:69:22:ae, ethertype IPv4 (0x0800), length 98: 192.168.26.129 &gt; 192.168.26.122: ICMP echo request, id 25, seq 10, length 64
17:17:58.883387 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 25, seq 10, length 64
</code></pre><p>vbox2 收到了来自 vbox1 的 ping request, 并发送 ping reply 给网关 vbox3, 这和我们预期的行为一致，说明 vbox2 没问题。</p>
<p>接着我又在 vbox3 上抓了一下包</p>
<pre tabindex="0"><code>root@vbox3:~# tcpdump -i enp0s8 --print -en
listening on enp0s8, link-type EN10MB (Ethernet), snapshot length 262144 bytes
01:49:50.730850 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 26, seq 1, length 64
01:49:51.790335 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 26, seq 2, length 64
01:49:53.203978 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 26, seq 3, length 64
01:49:55.993736 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype ARP (0x0806), length 60: Request who-has 192.168.26.123 tell 192.168.26.122, length 46
01:49:55.993751 08:00:27:d5:b5:13 &gt; 08:00:27:69:22:ae, ethertype ARP (0x0806), length 42: Reply 192.168.26.123 is-at 08:00:27:d5:b5:13, length 28
01:52:10.616571 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 27, seq 1, length 64
01:52:11.965582 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 27, seq 2, length 64
01:52:12.992503 08:00:27:69:22:ae &gt; 08:00:27:d5:b5:13, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 27, seq 3, length 64
</code></pre><p>vbox3 收到了 vbox2 转发来的包，但它没有进一步的发送动作，此时我拍脑袋一想，Linux 可能默认有限制，不转发包，于是我用 <strong>ubuntu 开启路由转发</strong> 作为关键字搜了一下，找到了配置项 <code>net.ipv4.ip_forward</code>, 我又用 <strong>ubuntu ipv4_forward</strong> 作为关键字搜索了一下，找到了 <a href="https://linuxconfig.org/how-to-turn-on-off-ip-forwarding-in-linux">ubuntu 开启 IP Forward 的文章</a>。</p>
<p>我执行以下命令，在 vbox3 上临时开启了 ip 转发的功能</p>
<pre tabindex="0"><code>sysctl -w net.ipv4.ip_forward=1
</code></pre><p>改完上述配置后，在 vbox1 上 ping <code>192.168.26.122</code> 就能 ping 通了。</p>
<p>在 vbox3 上抓包也能看到转发的 ICMP reply 包</p>
<pre tabindex="0"><code>01:58:54.790382 08:00:27:d5:b5:13 &gt; 08:00:27:4c:f0:52, ethertype IPv4 (0x0800), length 98: 192.168.26.122 &gt; 192.168.26.129: ICMP echo reply, id 28, seq 1, length 64
</code></pre><p><img src="https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-08-23-234135.png" alt=""></p>
<h2 id="参考链接">参考链接</h2>
<ul>
<li><a href="https://linux-audit.com/how-to-clear-the-arp-cache-on-linux/">How to clear the ARP cache on Linux?</a></li>
<li><a href="https://www.virtualbox.org/manual/ch06.html#network_nat_service">6.4. Network Address Translation Service</a></li>
<li><a href="https://linuxconfig.org/how-to-turn-on-off-ip-forwarding-in-linux">Linux IP forwarding – How to Disable/Enable using net.ipv4.ip_forward</a></li>
<li>其他用到的命令</li>
</ul>
<pre tabindex="0"><code># 查看 arp 表
arp -n
# 清空 arp 表
sudo ip -s -s neigh flush all
# 查看路由信息
route -n
</code></pre>
	<div class="text-muted mt-5 pt-3 border-top">
   August 24, 2023: <a href="https://github.com/bwangelme/647/commit/c89deb2fd82e09e7d65a49c1072b7f4f36c14f2b">z 20230824-000323 (c89deb2)</a>
</div>

</div>


          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-end text-xs-center order-sm-3">
        
        
        
<ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/bwangelme/" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2">
        <span>&copy; 2023 力行近乎仁，好问近乎智，知耻近乎勇 </span>
        <span class="ms-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener"></a></span>
        
      </div>
    </div>
  </div>
</footer>
    </div>
    
  <script src="/647/js/main.min.6f5832c0d01e88c997eeb57e6b773ea3e1ac128fdf53739b3c750242f2355881.js" integrity="sha256-b1gywNAeiMmX7rV&#43;a3c&#43;o&#43;GsEo/fU3ObPHUCQvI1WIE=" crossorigin="anonymous"></script>
<script src='/647/js/prism.js'></script>
<script src='/647/js/tabpane-persist.js'></script>

  </body>
</html>